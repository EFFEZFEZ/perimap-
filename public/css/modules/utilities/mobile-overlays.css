/**
 * Mobile Overlays Utilities - PériMap v614
 * 
 * Classes réutilisables pour les panneaux et overlays mobiles.
 * Évite la répétition des mêmes règles (position fixed, hauteur calculée,
 * suppression d'ombres) dans plusieurs fichiers de pages.
 * 
 * USAGE:
 *   Ajouter ces classes sur les conteneurs mobiles qui doivent
 *   remplir l'écran entre le header et la bottom nav.
 * 
 * Date: 2026-01-28
 */

/* ═══════════════════════════════════════════════════════════════════════
   VARIABLES LOCALES
   ═══════════════════════════════════════════════════════════════════════ */

:root {
    /* Hauteurs des éléments fixes */
    --header-height: 56px;
    --bottom-nav-height: 66px;
    
    /* Calcul de l'espace disponible */
    --mobile-content-height: calc(100vh - var(--header-height) - var(--bottom-nav-height));
    --mobile-content-height-svh: calc(100svh - var(--header-height) - var(--bottom-nav-height));
}

/* ═══════════════════════════════════════════════════════════════════════
   OVERLAY PLEIN ÉCRAN MOBILE
   ═══════════════════════════════════════════════════════════════════════ */

/**
 * Conteneur fullscreen entre header et bottom nav.
 * À utiliser sur les panneaux qui doivent occuper tout l'espace mobile.
 */
@media (max-width: 768px) {
    .mobile-fullscreen-panel {
        position: fixed;
        top: var(--header-height);
        left: 0;
        right: 0;
        bottom: var(--bottom-nav-height);
        width: 100%;
        height: var(--mobile-content-height);
        height: var(--mobile-content-height-svh); /* Override avec svh si supporté */
        min-height: auto;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        overscroll-behavior: none;
        -webkit-overflow-scrolling: touch;
        z-index: var(--z-fixed, 300);
    }

    /**
     * Version sans bottom nav (pour les vues plein écran).
     */
    .mobile-fullscreen-panel--no-nav {
        bottom: 0;
        height: calc(100vh - var(--header-height));
        height: calc(100svh - var(--header-height));
    }

    /**
     * Version sans header (rare, pour les modales).
     */
    .mobile-fullscreen-panel--no-header {
        top: 0;
        height: calc(100vh - var(--bottom-nav-height));
        height: calc(100svh - var(--bottom-nav-height));
    }
}

/* ═══════════════════════════════════════════════════════════════════════
   CARTE MOBILE (occupe tout sauf header)
   ═══════════════════════════════════════════════════════════════════════ */

@media (max-width: 768px) {
    .mobile-map-container {
        position: fixed;
        top: var(--header-height);
        left: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        height: calc(100vh - var(--header-height));
        height: calc(100svh - var(--header-height));
        z-index: var(--z-base, 0);
    }
}

/* ═══════════════════════════════════════════════════════════════════════
   BOTTOM SHEET MOBILE
   ═══════════════════════════════════════════════════════════════════════ */

@media (max-width: 768px) {
    /**
     * Bottom sheet basique avec coins arrondis en haut.
     */
    .mobile-bottom-sheet {
        position: fixed;
        left: 0;
        right: 0;
        bottom: var(--bottom-nav-height);
        max-height: 70vh;
        background: var(--bg-main, #ffffff);
        border-radius: 16px 16px 0 0;
        box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.12);
        overflow-y: auto;
        overscroll-behavior: contain;
        -webkit-overflow-scrolling: touch;
        z-index: var(--z-overlay, 400);
        transform: translateY(100%);
        transition: transform 0.35s cubic-bezier(0.32, 0.72, 0, 1);
    }

    .mobile-bottom-sheet.is-visible {
        transform: translateY(0);
    }

    /**
     * Handle de drag pour le bottom sheet.
     */
    .mobile-bottom-sheet__handle {
        width: 36px;
        height: 5px;
        background: var(--border, #e2e8f0);
        border-radius: 2.5px;
        margin: 8px auto 12px;
    }

    /* Dark mode */
    body.dark-theme .mobile-bottom-sheet {
        background: var(--bg-main, #0f172a);
        box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.5);
    }

    body.dark-theme .mobile-bottom-sheet__handle {
        background: rgba(255, 255, 255, 0.25);
    }
}

/* ═══════════════════════════════════════════════════════════════════════
   PANNEAU LATÉRAL MOBILE (style card sans ombre)
   ═══════════════════════════════════════════════════════════════════════ */

@media (max-width: 768px) {
    /**
     * Panneau qui s'adapte au conteneur sans effets visuels desktop.
     * Supprime les bordures, ombres et border-radius par défaut.
     */
    .mobile-flat-panel {
        width: 100%;
        max-width: 520px;
        margin: 0 auto;
        background: transparent;
        border: none;
        border-radius: 0;
        box-shadow: none;
    }

    /**
     * Version avec fond visible (pour contraste).
     */
    .mobile-flat-panel--bg {
        background: var(--bg-main, #ffffff);
    }

    body.dark-theme .mobile-flat-panel--bg {
        background: var(--bg-main, #0f172a);
    }
}

/* ═══════════════════════════════════════════════════════════════════════
   SAFE AREA PADDING
   ═══════════════════════════════════════════════════════════════════════ */

/**
 * Ajoute le padding pour les safe areas (iPhone X+).
 */
.mobile-safe-area-top {
    padding-top: env(safe-area-inset-top, 0px);
}

.mobile-safe-area-bottom {
    padding-bottom: env(safe-area-inset-bottom, 0px);
}

.mobile-safe-area-all {
    padding-top: env(safe-area-inset-top, 0px);
    padding-right: env(safe-area-inset-right, 0px);
    padding-bottom: env(safe-area-inset-bottom, 0px);
    padding-left: env(safe-area-inset-left, 0px);
}

/* ═══════════════════════════════════════════════════════════════════════
   HELPERS TACTILES
   ═══════════════════════════════════════════════════════════════════════ */

/**
 * Zone tactile minimum de 44x44px (recommandation Apple/Google).
 */
.mobile-touch-target {
    min-width: 44px;
    min-height: 44px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    -webkit-tap-highlight-color: transparent;
}

/**
 * Feedback visuel au toucher.
 */
.mobile-touch-feedback:active {
    transform: scale(0.96);
    transition: transform 0.1s ease;
}

/**
 * Pas de highlight au tap (pour les éléments custom).
 */
.mobile-no-tap-highlight {
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
}
