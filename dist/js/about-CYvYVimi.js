import"./chunks/modulepreload-polyfill-YP0FEG5d.js";/* empty css                     *//* empty css                     */const e=document.body;function t(t){e.classList.toggle("dark-theme",!!t);Array.from(document.querySelectorAll("[data-theme-toggle]")).forEach(e=>{e.setAttribute("aria-pressed",t?"true":"false"),e.title=t?"Th√®me clair":"Th√®me sombre"});Array.from(document.querySelectorAll(".theme-toggle-icon")).forEach(e=>{e.textContent=t?"‚òÄÔ∏è":"üåô"})}function n(e){e&&window.location.assign(`/#${e}`)}function s(){document.querySelectorAll(".nav-dropdown.is-open").forEach(e=>{e.classList.remove("is-open");const t=e.querySelector(".nav-dropdown-trigger");t&&t.setAttribute("aria-expanded","false")})}!function(){try{const e=localStorage.getItem("ui-theme"),n=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;t(e?"dark"===e:n)}catch(e){}}(),Array.from(document.querySelectorAll("[data-theme-toggle]")).forEach(n=>{n.addEventListener("click",()=>{const n=!e.classList.contains("dark-theme");t(n);try{localStorage.setItem("ui-theme",n?"dark":"light")}catch(s){}},{passive:!0})}),document.querySelectorAll(".nav-dropdown").forEach(e=>{const t=e.querySelector(".nav-dropdown-trigger");t&&(t.setAttribute("aria-expanded","false"),t.addEventListener("click",n=>{n.preventDefault();const a=!e.classList.contains("is-open");s(),e.classList.toggle("is-open",a),t.setAttribute("aria-expanded",a?"true":"false")}),t.addEventListener("keydown",e=>{"Escape"===e.key&&(s(),t.focus())}))}),document.addEventListener("click",e=>{e.target.closest(".nav-dropdown")||s()}),document.querySelectorAll(".nav-dropdown-item[data-action]").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),s(),n(e.dataset.action)})});const a=document.getElementById("mobile-menu-toggle"),o=document.getElementById("mobile-menu");a&&o&&(a.addEventListener("click",()=>{const t=o.classList.contains("hidden");a.classList.toggle("is-active"),o.classList.toggle("hidden"),e.classList.toggle("mobile-menu-open",t)}),o.querySelectorAll(".mobile-menu-category").forEach(e=>{e.addEventListener("click",()=>{const t="true"===e.getAttribute("aria-expanded"),n=e.nextElementSibling;o.querySelectorAll(".mobile-menu-category").forEach(t=>{if(t!==e){t.setAttribute("aria-expanded","false");const e=t.nextElementSibling;e&&e.classList.remove("is-expanded")}}),e.setAttribute("aria-expanded",(!t).toString()),n&&n.classList.toggle("is-expanded",!t)})}),document.addEventListener("click",t=>{o.classList.contains("hidden")||t.target.closest("#mobile-menu")||t.target.closest("#mobile-menu-toggle")||(a.classList.remove("is-active"),o.classList.add("hidden"),e.classList.remove("mobile-menu-open"))}),o.querySelectorAll("a.mobile-menu-item").forEach(t=>{t.addEventListener("click",s=>{const i=t.dataset.action;i&&s.preventDefault(),a.classList.remove("is-active"),o.classList.add("hidden"),e.classList.remove("mobile-menu-open"),i&&n(i)})}));let i=null,l={};const c={"Lignes majeures":["A","B","C","D"],"Lignes express":["e1","e2","e4","e5","e6","e7"],"Lignes de quartier":["K1A","K1B","K2","K3A","K3B","K4A","K4B","K5","K6"],Navettes:["N","N1"]},r=Object.values(c).flat();function d(){document.getElementById("modal").classList.remove("active"),document.getElementById("loginForm").style.display="block",document.getElementById("adminPanel").classList.remove("active"),document.getElementById("pwd").value="",document.getElementById("status").style.display="none",document.getElementById("loginStatus").style.display="none"}document.getElementById("adminTrigger").onclick=()=>{document.getElementById("modal").classList.add("active")},document.getElementById("modal").onclick=e=>{e.target===e.currentTarget&&d()},window.login=async function(){const e=document.getElementById("loginStatus"),t=document.getElementById("pwd").value;if("lou23"!==t)return e.style.display="block",e.className="status-msg error",void(e.textContent="Mot de passe incorrect");e.style.display="block",e.className="status-msg",e.textContent="Connexion...";try{const n=await fetch("/api/admin-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:t})});if(!n.ok){const e=await n.json();throw new Error(e.error||"Erreur serveur")}const{token:s}=await n.json();i=s,console.log("[Admin] Token received via API"),e.style.display="none",document.getElementById("loginForm").style.display="none",document.getElementById("adminPanel").classList.add("active"),async function(){try{const e=await fetch("data/line-status.json?t="+Date.now());l=await e.json(),function(){const e=["normal","perturbation","retard","annulation","travaux"],t={normal:"‚úì Normal",perturbation:"‚ö† Perturb√©",retard:"‚è± Retard",annulation:"‚úï Annul√©",travaux:"üöß Travaux"};let n="";for(const[s,a]of Object.entries(c))n+=`<tr class="category-row"><td colspan="3"><strong>${s}</strong></td></tr>`,a.forEach(s=>{var a;const o=(null==(a=l.lines)?void 0:a[s])||{status:"normal",message:""},i=e.map(e=>`<option value="${e}" ${o.status===e?"selected":""}>${t[e]}</option>`).join("");n+=`<tr>\n                        <td><span class="admin-line-badge">${s}</span></td>\n                        <td><select id="s-${s}">${i}</select></td>\n                        <td><input id="m-${s}" value="${o.message||""}" placeholder="Message (optionnel)"></td>\n                    </tr>`});document.getElementById("trafficTable").innerHTML=n}()}catch(e){console.error("Erreur chargement:",e)}}()}catch(n){e.style.display="block",e.className="status-msg error",e.textContent=n.message||"Erreur de connexion"}},window.save=async function(){const e=document.getElementById("status");if(!i)return e.className="status-msg error",void(e.textContent="Token admin manquant (variable env)");const t={};if(r.forEach(e=>{t[e]={status:document.getElementById(`s-${e}`).value,message:document.getElementById(`m-${e}`).value}}),l.lines)for(const[a,o]of Object.entries(l.lines))r.includes(a)||a.startsWith("_")||(t[a]=o);const n={lastUpdate:(new Date).toISOString().slice(0,19),globalMessage:l.globalMessage||"",lines:t};try{e.className="status-msg",e.textContent="Sauvegarde en cours...",e.style.display="block";const t=btoa(unescape(encodeURIComponent(JSON.stringify(n,null,2)))),s=await fetch("https://api.github.com/repos/EFFEZFEZ/perimap-/contents/public/data/line-status.json",{headers:{Authorization:`token ${i}`}}),a=await s.json();await fetch("https://api.github.com/repos/EFFEZFEZ/perimap-/contents/public/data/line-status.json",{method:"PUT",headers:{Authorization:`token ${i}`,"Content-Type":"application/json"},body:JSON.stringify({message:`Mise √† jour √©tat lignes - ${(new Date).toLocaleString("fr-FR")}`,content:t,sha:a.sha})}),e.className="status-msg success",e.textContent="‚úì Modifications sauvegard√©es ! Les changements seront visibles dans quelques minutes."}catch(s){e.className="status-msg error",e.textContent="Erreur: "+s.message}},window.closeModal=d,window.closeModal=d;
